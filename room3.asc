// room script file

function room_Load()
{
  // Escalado de personajes
  cTotoro.Scaling = 150;
  cMei.Scaling = 100;
  cHombreRaro.Scaling = 100;
  cTatsuo.Scaling = 100;
  cBus.Scaling = 120;
  cBus2.Scaling = 120;
  cGatobus.Scaling = 130;
  cSatsuki.Scaling = 100;
  
  // Escalado de objetos
  oHojaArbol.Scaling = 90;
  oPlantaSuelo.Scaling = 140;
  oPiedra.Scaling = 90;
  
}

function room_FirstLoad()
{
  StartCutscene(eSkipESCOnly);
  
  //Se bajan las franjas
  oFranjaSuperiorRoom3.Move(0, 40, 1, eNoBlock, eAnywhere);
  oFranjaInferiorRoom3.Move(0, 440, 1, eBlock, eAnywhere);
  
  cMei.ChangeView(12);
  cSatsuki.ChangeView(9);
 
  // Andan hasta un punto
  cMei.Walk(78, 351, eNoBlock, eAnywhere);
  cSatsuki.Walk(67, 320, eBlock, eAnywhere);
  
  cMei.FaceDirection(eDirectionUp);
  cSatsuki.FaceDirection(eDirectionDown);
  
  //Dicen el primer dialogo
  dialogoRoom3();
  
  cMei.Walk(164, 327, eNoBlock, eAnywhere);
  cMei.FaceDirection(eDirectionDown);
  
  // Se quitan las franjas
  oFranjaSuperiorRoom3.Move(0, 0, 1, eNoBlock, eAnywhere);
  oFranjaInferiorRoom3.Move(0, 475, 1, eNoBlock, eAnywhere);
  
  EndCutscene();
  
}

//Si interactuo con la piedra
function oPiedra_Interact(Object *theObject, CursorMode mode)
{
  
  if(!dialogoConTotoroCompletado){
    
    imgDialogo.BackgroundGraphic = 148;
    mostrarDialogo("Deberia hablar con Mei primero...");
    
  }else if(dialogoConTotoroCompletado){
    
    cSatsuki.Walk(oPiedra.X,  oPiedra.Y,  eBlock);
    oPiedra.Visible = false;
    cSatsuki.AddInventory(iPiedra);
    
    // Diálogo interactuar piedra
    imgDialogo.BackgroundGraphic = 148;
    mostrarDialogo("Con esta piedra puedo llegar a las zonas altas");
  }
}

//Si miro la piedra
function oPiedra_Look(Object *theObject, CursorMode mode)
{
  // Diálogo mirar piedra
  imgDialogo.BackgroundGraphic = 148;
  mostrarDialogo("Igual puedo usar aquella piedra");
}

function oHojaArbol_UseInv(Object *theObject, CursorMode mode)
{
  if (player.ActiveInventory == iPiedra) {
    
  player.LoseInventory(iPiedra);
  oHojaArbol.Move(216,  322,  3,  eBlock,  eAnywhere);
  gHojaDown = 1;
  
  //Diálogo hoja
  imgDialogo.BackgroundGraphic = 148;
  mostrarDialogo("Bingo!");
  
  }
}

//Si interactuo con la planta del suelo
function oPlantaSuelo_Interact(Object *theObject, CursorMode mode)
{
   if(!dialogoConTotoroCompletado){
     
    imgDialogo.BackgroundGraphic = 148;
    mostrarDialogo("Deberia hablar con Mei primero...");
    
  }else if(dialogoConTotoroCompletado){
    // Diálogo interactuar hoja pequeña
    cSatsuki.Walk(oPlantaSuelo.X, oPlantaSuelo.Y, eBlock, eWalkableAreas);
    cSatsuki.AddInventory(iHojaPequena);
    oPlantaSuelo.Visible = false;
    
    imgDialogo.BackgroundGraphic = 148;
    mostrarDialogo("Esto me puede venir bien");
    
  }
}

// Si miro a la planta del suelo
function oPlantaSuelo_Look(Object *theObject, CursorMode mode)
{
  
  // Diálogo interactuar con hoja pequeña
  imgDialogo.BackgroundGraphic = 148;
  mostrarDialogo("Voy a acercarme a verla mejor");
  
}

//Si interactuo con la piedra del arbol
function oHojaArbol_Interact(Object *theObject, CursorMode mode)
{
  if(!dialogoConTotoroCompletado){
    
    imgDialogo.BackgroundGraphic = 148;
    mostrarDialogo("Deberia hablar con Mei primero...");
  }
  
  if (gHojaDown == 0){
    
    imgDialogo.BackgroundGraphic = 148;
    mostrarDialogo("No llego... Necesitare algo de ayuda");

  }
  
  if (gHojaDown == 1){
      cSatsuki.Walk(oHojaArbol.X,  oHojaArbol.Y,  eBlock);
      cSatsuki.FaceObject(oHojaArbol);
      oHojaArbol.Visible = false;
      cSatsuki.AddInventory(iHojaArbol);
      
      imgDialogo.BackgroundGraphic = 148;
      mostrarDialogo("Lo consegui! Ahora Totoro no se mojará");
    }
}
