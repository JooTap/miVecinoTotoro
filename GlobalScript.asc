// main global script file
bool room2Completado = false;

// called when the game starts, before the first room is loaded
function game_start()
{
  // Auto-save on the save slot 999
  SetRestartPoint();
}

// called on every game cycle, except when the game is blocked
function repeatedly_execute()
{
  
}

// called on every game cycle, even when the game is blocked
function repeatedly_execute_always()
{
}

// called when a key is pressed
function on_key_press(eKeyCode keycode, int mod)
{
  if (IsGamePaused())
  {
    // game paused, so don't react to any keypresses
    keycode = 0;
  }
  else if (keycode == eKeyQ && (mod & eKeyModCtrl))
  {
    // Ctrl-Q will quit the game
    QuitGame(1);
  }
  else if (keycode == eKeyF9)
  {
    // F9 will restart the game
    RestartGame();
  }
  else if (keycode == eKeyF12)
  {
    // F12 will save a screenshot to the save game folder
    SaveScreenShot("screenshot.pcx");
  }
  else if (mod & eKeyModCtrl)
  {
    if (keycode == eKeyS)
    {
      // Ctrl-S will give the player all defined inventory items
      Debug(0, 0);
    }
    else if (keycode == eKeyV)
    {
      // Ctrl-V will show game engine version and build date
      Debug(1, 0);
    }
    else if (keycode == eKeyA)
    {
      // Ctrl-A will show walkable areas
      Debug(2, 3);
    }
    else if (keycode == eKeyX)
    {
      // Ctrl-X will let the player teleport to any room
      Debug(3, 0);
    }

  }
}

// called when a mouse button is clicked
function on_mouse_click(MouseButton button)
{
  if (IsGamePaused())
  {
    // game is paused, so do nothing (i.e. don't process mouse clicks)
  }
  else if (button == eMouseLeft)
  {
    // left-click, so try using the current mouse cursor mode at this position
    Room.ProcessClick(mouse.x, mouse.y, mouse.Mode);
  }
  else if (button == eMouseRight)
  {
    // right-click, so cycle the mouse cursor mode
    mouse.SelectNextMode();
  }
}

function dialog_request(int param)
{

}
// Este código hace invisible la GUI de inventario,  he puesto un botón tanto como en gInv como en gMochila. Esto abre y cierra la gui.
function bMochila_OnClick(GUIControl *control, MouseButton button)
{
  if (gInv.Visible == false)
  {
    gInv.Visible = true;
    gMochila.Visible = false;
    }else{
    gInv.Visible = false; 
    gMochila.Visible = true;    
  }
}

function Exit_OnClick(GUIControl *control, MouseButton button)
{
  gInv.Visible = false;
  gMochila.Visible = true;
}

function cMei_Talk(Character *theCharacter, CursorMode mode)
{
  if(/*Si no tenes la cuerda*/){
    dialogoMeiSinCuerda();
  }else if(/*Si tienes la cuerda*/){
    imgDialogo.BackgroundGraphic = 150;
    mostrarDialogo("Satsuki, ¿me puedes devolver ya mi cuerda? Me aburro…");
    
    imgDialogo.BackgroundGraphic = 148;
    mostrarDialogo("Lo siento Mei, todavía me hace falta.");
  }
    
  cSatsuki.Walk(204, 325, eBlock, eWalkableAreas);
  cSatsuki.FaceDirection(eDirectionLeft);
  
  cMei.FaceDirection(eDirectionRight);
  
  // Primer tramo de dialogo room 3
  gDialogos.Visible = true;
  dialogo2Room3();
  gDialogos.Visible = false;
  
  //Pasa el primer bus y se baja el extraño
  cBus.Move(80, 360, eBlock, eAnywhere);
  
  cHombreRaro.Move(100, 340, eBlock, eAnywhere);
  cSatsuki.FaceDirection(eDirectionDownRight);
  
  cBus.Move(920, 360, eNoBlock, eAnywhere);
  Wait(180);
  cHombreRaro.Walk(1200, 340, eNoBlock, eAnywhere);
  cSatsuki.FaceDirection(eDirectionLeft);
  Wait(180);
  
  //Siguiente dialogo
  dialogo3Room3();
  
  //Aparece totoro
  cSatsuki.FaceDirection(eDirectionDown);
  cMei.FaceDirection(eDirectionDown);
  
  cTotoro.Walk(246, 340, eNoBlock, eAnywhere);
    
}

function ctotoroBlanco_Interact(Character *theCharacter, CursorMode mode)
{
  imgDialogo.BackgroundGraphic = 150;
  mostrarDialogo("Vaya… que bonitos y pequeñitos son. Se ven tal como la abuela los describió.");

  // Andas hacia los totoros
  cSatsuki.Walk(534, 352, eBlock, eWalkableAreas);
  
  // Los totoros se asustan
  ctotoroAzul.Walk(688, 348, eNoBlock, eAnywhere);
  ctotoroBlanco.Walk(654, 364, eBlock, eAnywhere);
  Wait(75);
  
  imgDialogo.BackgroundGraphic = 150;
  mostrarDialogo("Vaya... Se han asustado");
  
  imgDialogo.BackgroundGraphic = 149;
  mostrarDialogo("¡Mei, cariño ven ya! ¡La comida se va a enfriar!");
  
  imgDialogo.BackgroundGraphic = 150;
  mostrarDialogo("¡Perdon! ¡Ya voy!");
}

function ctotoroAzul_Interact(Character *theCharacter, CursorMode mode)
{
  
  imgDialogo.BackgroundGraphic = 150;
  mostrarDialogo("Vaya… que bonitos y pequeñitos son. Se ven tal como la abuela los describió.");

  // Andas hacia los totoros
  cSatsuki.Walk(534, 352, eBlock, eWalkableAreas);
  
  // Los totoros se asustan
  ctotoroAzul.Walk(688, 348, eNoBlock, eAnywhere);
  ctotoroBlanco.Walk(654, 364, eBlock, eAnywhere);
  Wait(75);
  
  imgDialogo.BackgroundGraphic = 150;
  mostrarDialogo("Vaya... Se han asustado...");
  
  imgDialogo.BackgroundGraphic = 149;
  mostrarDialogo("¡Mei, cariño ven ya! ¡La comida se va a enfriar!");
  
  imgDialogo.BackgroundGraphic = 150;
  mostrarDialogo("¡Perdon! ¡Ya voy!");
  
}


function cMei_Look(Character *theCharacter, CursorMode mode)
{
    imgDialogo = 150;
    mostrarDialogo("¿Qué es eso que tienes, Mei?");
}
