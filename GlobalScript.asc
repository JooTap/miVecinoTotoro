// main global script file

// called when the game starts, before the first room is loaded
function game_start()
{
  // Auto-save on the save slot 999
  SetRestartPoint();
}

// called on every game cycle, except when the game is blocked
function repeatedly_execute()
{
  
}

// called on every game cycle, even when the game is blocked
function repeatedly_execute_always()
{
}

// called when a key is pressed
function on_key_press(eKeyCode keycode, int mod)
{
  if (IsGamePaused())
  {
    // game paused, so don't react to any keypresses
    keycode = 0;
  }
  else if (keycode == eKeyQ && (mod & eKeyModCtrl))
  {
    // Ctrl-Q will quit the game
    QuitGame(1);
  }
  else if (keycode == eKeyF9)
  {
    // F9 will restart the game
    RestartGame();
  }
  else if (keycode == eKeyF12)
  {
    // F12 will save a screenshot to the save game folder
    SaveScreenShot("screenshot.pcx");
  }
  else if (mod & eKeyModCtrl)
  {
    if (keycode == eKeyS)
    {
      // Ctrl-S will give the player all defined inventory items
      Debug(0, 0);
    }
    else if (keycode == eKeyV)
    {
      // Ctrl-V will show game engine version and build date
      Debug(1, 0);
    }
    else if (keycode == eKeyA)
    {
      // Ctrl-A will show walkable areas
      Debug(2, 3);
    }
    else if (keycode == eKeyX)
    {
      // Ctrl-X will let the player teleport to any room
      Debug(3, 0);
    }
    
  }
}

// called when a mouse button is clicked
function on_mouse_click(MouseButton button)
{
  if (IsGamePaused())
  {
    // game is paused, so do nothing (i.e. don't process mouse clicks)
  }
  else if (button == eMouseLeft)
  {
    // left-click, so try using the current mouse cursor mode at this position
    Room.ProcessClick(mouse.x, mouse.y, mouse.Mode);
  }
  else if (button == eMouseRight)
  {
    // right-click, so cycle the mouse cursor mode
    mouse.SelectNextMode();
  }
}

function dialog_request(int param)
{

}

// Este código hace invisible la GUI de inventario,  he puesto un botón tanto como en gInv como en gMochila. Esto abre y cierra la gui.
// Pienso que sería más optimo en vez de poner el mismo botón, poner un botón de una X o algo para cerrar el inventario.
function bMochila_OnClick(GUIControl *control, MouseButton button)
{
  if (gInv.Visible == false)
  {
    gInv.Visible = true;
    gMochila.Visible = false;
    }else{
    gInv.Visible = false; 
    gMochila.Visible = true;    
  }
}

// Esta parte hace lo que comentaste del boton,  quedaria hacer un sprite para ese boton y listo
function Exit_OnClick(GUIControl *control, MouseButton button)
{
  gInv.Visible = false;
  gMochila.Visible = true;
}

function mostrarDialogo(String texto) {
  
  Mouse.Visible = true;
  Mouse.Mode = eModePointer;
  
  bool continuarDialogo = false;
  gDialogos.Visible = true;
    
  lblTexto.BringToFront();
    
  int total = texto.Length;
  int currentLength = 0;
  
  sHablando.Play();
  
  while (currentLength < total) {
     
    currentLength++; // aumenta la longitud del texto a mostrar
    lblTexto.Text = texto.Substring(0, currentLength);
    Wait(1); // controla la velocidad del texto
  }
  
  sHablando.Stop();

  while (!continuarDialogo) {
    
    Wait(1);
  }
}

function cNanny_Talk(Character *theCharacter, CursorMode mode)
{
  cSatsuki.Walk(cNanny.x, cNanny.y, eBlock);
  imgDialogo.Visible = true;
  imgDialogo.BackgroundGraphic = 51; // Satsuki
  mostrarDialogo("¡Nanny! ¡Nos hemos encontrado con unos bichitos negros en el desvan! ¿Nos cuentas algo sobre los animalitos magicos que viven en esta casa?");
  imgDialogo.BackgroundGraphic = 1; // Nanny
  mostrarDialogo("Claro niñas. Sentaos aquí a mi lado. Según dicen las leyendas, en las casas abandonadas viven los conejos de polvo porque les gustan los sitios tristes. Sin embargo, ahora que os habéis mudado aquí, están saliendo porque sois unas niñas muy felices.");
  imgDialogo.BackgroundGraphic = 2; //Mei
  mostrarDialogo("¡Hala! Pues yo no quería que se fueran. Ni siquiera he podido atrapar uno cuando los he tenido enfrente, se me ha escapado…");
  imgDialogo.BackgroundGraphic = 51;
  mostrarDialogo("¿Hay algún otro bichito mágico que pueda vivir aquí?");
  imgDialogo.BackgroundGraphic = 1;
  mostrarDialogo("");
  
  //Me queda completar el dialogo y testearlo :D
}
function Button1_OnClick(GUIControl *control, MouseButton button, bool continuarDialogo)
{
  continuarDialogo = true;
}

