// room script file

function room_Load()
{
 cNanny.Scaling = 170;
 cSatsuki.Scaling = 150;
 cMei.Scaling = 140;
}

function hCambiarRoom_WalkOn(Hotspot *theHotspot)
{
  player.ChangeRoom(2, 23, 351, eDirectionRight);
}

function room_AfterFadeIn()
{
  // Condicionante para ejecutar por separado las entradas a la room 1
  if(room2Completado){
    
    // Vuelta a la room 1
    StartCutscene(eSkipESCOnly);
    // Poner franjas
    oFranjaSuperiorRoom1.Move(0, 40, 1, eNoBlock, eAnywhere);
    oFranjaInferiorRoom1.Move(0, 440, 1, eNoBlock, eAnywhere);

    imgDialogo.BackgroundGraphic = 148;// Satsuki
    
    mostrarDialogo("¡Ya llegué! Qué hambre tengo… ");
    mostrarDialogo("¡Hola Mei!");
    
    imgDialogo.BackgroundGraphic = 150; //Mei
    mostrarDialogo("¡Satsuki no vas a creer lo que he visto! He salido al jardín a explorar mientras papá trabajaba.");
    mostrarDialogo("He encontrado a unos Totoros pequeñitos, como los del cuento de la abuela.");
    
    // Se sienta al lado de Mei
    cSatsuki.Walk(253, 304, eBlock, eWalkableAreas);
    cSatsuki.Walk(34, 338, eBlock, eWalkableAreas);
    cSatsuki.ChangeView(6);
    
    imgDialogo.BackgroundGraphic = 148;
    mostrarDialogo("¿Unos Totoros pequeños? ¿Cómo los has encontrado?");
    
    imgDialogo.BackgroundGraphic = 150; //Mei
    mostrarDialogo("He seguido un rastro de bellotas.");
    
    imgDialogo.BackgroundGraphic = 148;
    mostrarDialogo("No puedo creer que me los haya perdido. Prométeme que la próxima vez que los encuentres me llevarás contigo.");
    
    imgDialogo.BackgroundGraphic = 150; //Mei
    mostrarDialogo("No estés triste Satsuki. Te prometo que la próxima vez los verás tú también.");
    
    EndCutscene();
    
    //FadeOut
    FadeOut(5);
    
    //Los personajes se cambian de posicion
    cMei.ChangeView(3);
    cSatsuki.ChangeView(1);
    
    cNanny.Move(118, 314, eNoBlock, eAnywhere);
    cSatsuki.Walk(522, 337, eNoBlock, eWalkableAreas);
    cMei.Move(592, 344, eBlock, eWalkableAreas);
    cMei.FaceDirection(eDirectionRight);
    FadeIn(10);
    Wait(120);
    
    imgDialogo.BackgroundGraphic = 150;
    mostrarDialogo("Oh, sigue lloviendo. Mei, deberíamos coger el paraguas de papá e ir a buscarlo a la estación. Sino se va a mojar.");
    
    imgDialogo.BackgroundGraphic = 148;
    mostrarDialogo("Vale. ¿Dónde lo dejaste ,Satsuki?");
    
    imgDialogo.BackgroundGraphic = 150;
    mostrarDialogo("Está guardado en el armario, dejé la llave encima de la mesa.");
    
    // Anda hacia la mesa
    cSatsuki.Walk(272, 364, eBlock, eWalkableAreas);
    
    Wait(15);
    cSatsuki.FaceDirection(eDirectionRight);
    Wait(35);
    cSatsuki.FaceDirection(eDirectionLeft);
    
    mostrarDialogo("¿¡Eh?! No está aquí. ¿Dónde podrá haber ido a parar…?");
    
    cMei.Walk(563, 388, eBlock, eWalkableAreas);
    cMei.ChangeView(10);
    
    oPolvoSuelo.Visible = true;
    // Se quitan las franjas
    oFranjaSuperiorRoom1.Move(0, 0, 1, eNoBlock, eAnywhere);
    oFranjaInferiorRoom1.Move(0, 475, 1, eNoBlock, eAnywhere);
    
    //Aprecen los bichos de polvo con la llave entre ellos
    
    oBichoDePolvo2.Move(11, 72, 2, eNoBlock, eAnywhere);
    oLlave.Move(0, 71, 1, eNoBlock, eAnywhere);
    oBichosDePolvo.Move(1, 91, 1, eNoBlock, eAnywhere);
    oBichodePolvo3.Move(-5, 50, 1, eNoBlock, eAnywhere);
  
    //Aqui va la programacion del puzle del paraguas
    
  }else{
    
    StartCutscene(eSkipESCOnly); // Esto es para saltar toda la cinematica con el Esc,  cuando acabemos el juego lo eliminamos
    
    // Se ponen las franjas
    oFranjaSuperiorRoom1.Move(0, 40, 1, eNoBlock, eAnywhere);
    oFranjaInferiorRoom1.Move(0, 440, 1, eNoBlock, eAnywhere);
    Wait(80);
    
    //Se acercan las dos niñas
    cSatsuki.Walk(20, 355, eNoBlock, eAnywhere);
    cMei.Walk(13, 309, eBlock, eAnywhere);
    
    cMei.FaceDirection(eDirectionRight);
    cSatsuki.FaceDirection(eDirectionRight);
    
    imgDialogo.BackgroundGraphic = 148; // Satsuki
    mostrarDialogo("¡Nanny! ¡Nos hemos encontrado con unos bichitos negros en el desvan! ¿Nos cuentas algo sobre los animalitos magicos que viven en esta casa?");

    imgDialogo.BackgroundGraphic = 149; // Nanny
    mostrarDialogo("Claro niñas. Sentaos aquí a mi lado. Según dicen las leyendas, en las casas abandonadas viven los conejos de polvo porque les gustan los sitios tristes. Sin embargo, ahora que os habéis mudado aquí, están saliendo porque sois unas niñas muy felices.");
    
    // Se sientan las niñas
    cSatsuki.ChangeView(6);
    cMei.Walk(100, 330, eBlock, eWalkableAreas);
    cMei.ChangeView(11);
    Wait(30);
    
    // Comienza el dialogo
    dialogoRoom1();
    
    // Se quitan las franjas
    oFranjaSuperiorRoom1.Move(0, 0, 1, eNoBlock, eAnywhere);
    oFranjaInferiorRoom1.Move(0, 475, 1, eNoBlock, eAnywhere);
    
    // NavMesh, Satsuki se sale de la escena
    cSatsuki.Walk(30, 304, eBlock, eWalkableAreas);
    cSatsuki.Walk(246, 304, eBlock, eWalkableAreas);
    cSatsuki.Walk(623, 327, eBlock, eWalkableAreas);
    
    EndCutscene();
  }
}

function oPolvoSuelo_Look(Object *theObject, CursorMode mode)
{
  imgDialogo.BackgroundGraphic = 148;
  mostrarDialogo("¿Eh? ¿Y todo este polvo? Parece que va hacia la cocina…");
}

function hRinconPolvo_Look(Hotspot *theHotspot, CursorMode mode)
{
  /*
  if(no tiene la escoba ){
    
  imgDialogo.BackgroundGraphic = 148;
  mostrarDialogo("Vaya, sí que se ha acumulado polvo allí. ¿Hmm? Juraría ver algo brillante entre el polvo. Ojalá tuviera algo para limpiarlo.");
  }
  */
}

function hRinconPolvo_Interact(Hotspot *theHotspot, CursorMode mode)
{
  /*
  if(no tiene la escoba ){
      
  imgDialogo.BackgroundGraphic = 148;
  mostrarDialogo("Tal vez debería no tocar esta esquina sin limpiarla antes, me voy a manchar.");
  }
  */
}
