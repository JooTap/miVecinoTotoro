// main global script file

// called when the game starts, before the first room is loaded
function game_start()
{
  // Auto-save on the save slot 999
  SetRestartPoint();
}

// called on every game cycle, except when the game is blocked
function repeatedly_execute()
{
  
}

// called on every game cycle, even when the game is blocked
function repeatedly_execute_always()
{
}

// called when a key is pressed
function on_key_press(eKeyCode keycode, int mod)
{
  if (IsGamePaused())
  {
    // game paused, so don't react to any keypresses
    keycode = 0;
  }
  else if (keycode == eKeyQ && (mod & eKeyModCtrl))
  {
    // Ctrl-Q will quit the game
    QuitGame(1);
  }
  else if (keycode == eKeyF9)
  {
    // F9 will restart the game
    RestartGame();
  }
  else if (keycode == eKeyF12)
  {
    // F12 will save a screenshot to the save game folder
    SaveScreenShot("screenshot.pcx");
  }
  else if (mod & eKeyModCtrl)
  {
    if (keycode == eKeyS)
    {
      // Ctrl-S will give the player all defined inventory items
      Debug(0, 0);
    }
    else if (keycode == eKeyV)
    {
      // Ctrl-V will show game engine version and build date
      Debug(1, 0);
    }
    else if (keycode == eKeyA)
    {
      // Ctrl-A will show walkable areas
      Debug(2, 3);
    }
    else if (keycode == eKeyX)
    {
      // Ctrl-X will let the player teleport to any room
      Debug(3, 0);
    }

  }
}

// called when a mouse button is clicked
function on_mouse_click(MouseButton button)
{
  if (IsGamePaused())
  {
    // game is paused, so do nothing (i.e. don't process mouse clicks)
  }
  else if (button == eMouseLeft)
  {
    // left-click, so try using the current mouse cursor mode at this position
    Room.ProcessClick(mouse.x, mouse.y, mouse.Mode);
  }
  else if (button == eMouseRight)
  {
    // right-click, so cycle the mouse cursor mode
    mouse.SelectNextMode();
  }
}

function dialog_request(int param)
{

}

// Este código hace invisible la GUI de inventario,  he puesto un botón tanto como en gInv como en gMochila. Esto abre y cierra la gui.
// Pienso que sería más optimo en vez de poner el mismo botón, poner un botón de una X o algo para cerrar el inventario.
function bMochila_OnClick(GUIControl *control, MouseButton button)
{
  if (gInv.Visible == false)
  {
    gInv.Visible = true;
    gMochila.Visible = false;
    }else{
    gInv.Visible = false; 
    gMochila.Visible = true;    
  }
}

// Esta parte hace lo que comentaste del boton,  quedaria hacer un sprite para ese boton y listo
function Exit_OnClick(GUIControl *control, MouseButton button)
{
  gInv.Visible = false;
  gMochila.Visible = true;
}

function mostrarDialogo(String texto) {
  
  gDialogos.Visible = true;
    
  lblTexto.BringToFront();
    
  int total = texto.Length;
  int i = 0;
  
  sHablando.Play();
  
  while (i < total) {
     
    i++; // aumenta la longitud del texto a mostrar
    lblTexto.Text = texto.Substring(0, i);
    Wait(1); // controla la velocidad del texto
  }
  
  sHablando.Stop();
  Wait(1); // Tiempo entre dialogo y dialogo
}

//Este codigo es el dialogo entero,  queda arreglar unos detalles tontos pero ya esta practicamente acabada
function dialogoRoom1(){
  
  cSatsuki.Walk(cNanny.x, cNanny.y, eBlock);
  
  imgDialogo.Visible = true;
  
  imgDialogo.BackgroundGraphic = 51; // Satsuki
  mostrarDialogo("¡Nanny! ¡Nos hemos encontrado con unos bichitos negros en el desvan! ¿Nos cuentas algo sobre los animalitos magicos que viven en esta casa?");
  
  imgDialogo.BackgroundGraphic = 1; // Nanny
  mostrarDialogo("Claro niñas. Sentaos aquí a mi lado. Según dicen las leyendas, en las casas abandonadas viven los conejos de polvo porque les gustan los sitios tristes. Sin embargo, ahora que os habéis mudado aquí, están saliendo porque sois unas niñas muy felices.");
  
  imgDialogo.BackgroundGraphic = 2; //Mei
  mostrarDialogo("¡Hala! Pues yo no quería que se fueran. Ni siquiera he podido atrapar uno cuando los he tenido enfrente, se me ha escapado…");
  
  imgDialogo.BackgroundGraphic = 51;
  mostrarDialogo("¿Hay algún otro bichito mágico que pueda vivir aquí?");
  
  imgDialogo.BackgroundGraphic = 1;
  mostrarDialogo("Existen unos seres llamados Totoros, a los que les gusta corretear por el campo y robar [font1]bellotas[font0]. Se dice que viven en el interior de los bosques porque no les gusta ser vistos. Son muy precavidos y cuidadosos, hay pocas personas que los llegan a ver… Solo los podrás conocer si ellos consideran que eres una [font1]buena persona[font0].");
  
  imgDialogo.BackgroundGraphic = 2;
  mostrarDialogo("¿Y cómo son? ¿Son igual que los bichitos de polvo?");
  
  imgDialogo.BackgroundGraphic = 1;
  mostrarDialogo("Hay totoros de todos los tamaños. Sin embargo, todos tienen un pelaje suave, unos ojos grandes y brillantes, y unas orejas largas.");
  
  imgDialogo.BackgroundGraphic = 51;
  mostrarDialogo("Y los totoros… ¿viven solos?");
  
  imgDialogo.BackgroundGraphic = 1;
  mostrarDialogo("No, les gusta vivir con otros como ellos, para poder protegerse y jugar entre ellos. Cuando los árboles susurran y los vientos cantan, los Totoros saltan y entre las hojas bailan.");
  
  imgDialogo.BackgroundGraphic = 2;
  mostrarDialogo("¡Yo quiero ver uno! ¡Satsuki, salgamos al jardín!");
  
  imgDialogo.BackgroundGraphic = 51;
  mostrarDialogo("Lo siento, Mei, pero yo me tengo que ir al colegio. Te prometo que cuando vuelva, buscaremos a los Totoros.");
  
  imgDialogo.BackgroundGraphic = 2;
  mostrarDialogo("Vale… ¡Adiós, Satsuki!");
  
  imgDialogo.BackgroundGraphic = 1;
  mostrarDialogo("Hasta luego, Satsuki. Yo seguiré aquí cuando vuelvas.");
  
  imgDialogo.BackgroundGraphic = 51;
  mostrarDialogo("¡Adiós!");
  
  imgDialogo.Visible = false;
  gDialogos.Visible = false;
  
  cSatsuki.Walk(610, 324, eBlock, eWalkableAreas);
  //oFranjaSuperior.Move(0, 40, 1, eNoBlock, eAnywhere);
  //oFranjaInferior.Move(0, 430, 1, eNoBlock, eAnywhere);
  
  //No se bajan las franjas alfinal
  //corregir los dialogos para que se pasen cuando pulsas una tecla o cuando pulsas el boton
  //Corregir la mesa
  //Corregir tipografia(no se ven las tildes con esta)
}

function cNanny_Talk(Character *theCharacter, CursorMode mode)
{
  dialogoRoom1();
}


function Button1_OnClick(GUIControl *control, MouseButton button, bool continuarDialogo)
{

}

